<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rants' Metadata Editor!</title>

<meta name="description" content="Browser-based IL2CPP global-metadata.dat editor: inspect header, view and edit strings in place, and export." />
<meta property="og:title" content="Rants' Metadata Editor!" />
<meta property="og:description" content="Inspect and in-place edit Unity IL2CPP global-metadata.dat strings right in your browser!" />
<meta property="og:url" content="https://rantsszi.github.io/rants-metadata-editor/" />

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#070a17; --panel:#12183b;
    --text:#eaf1ff; --muted:#97a6cf;
    --neon:#47b6ff; --neon2:#ff5bd1; --ok:#5ff3c1; --bad:#ff6b8a; --warn:#ffd36e;
    --border:#232c63; --grid:#1b2350;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Ubuntu,Arial;
    color:var(--text);
    background:radial-gradient(1200px 600px at 10% -10%, #17215a55, transparent 60%),
               radial-gradient(900px 500px at 110% 10%, #38215a55, transparent 60%),
               linear-gradient(180deg,#070a17,#070a17);
  }
  header{padding:56px 16px 20px; text-align:center; position:relative;}
  header::before{
    content:"";position:absolute;inset:-40% -40% auto -40%;
    height:200%;background:conic-gradient(from 0deg,var(--neon),var(--neon2),var(--ok),var(--neon));
    filter:blur(80px);opacity:.12;animation:spin 14s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  h1{margin:0;font-family:Orbitron,sans-serif;font-weight:800;font-size:2.1rem;
     text-shadow:0 0 14px #1c7ad8aa,0 0 30px #1c7ad866;}
  .subtitle{color:var(--muted);margin-top:10px}
  main{max-width:1200px;margin:0 auto;padding:20px}
  .bar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:14px}
  .btn,.text{
    background:#0b1030;border:1px solid var(--border);color:var(--text);
    padding:10px 14px;border-radius:10px;font-size:.95rem;cursor:pointer;transition:.18s;
  }
  .btn:hover{border-color:var(--neon);box-shadow:0 0 12px #47b6ff66;transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(135deg,#143a7a,#0c2a5e);border-color:#1b4e9a}
  .btn.good{background:linear-gradient(135deg,#0f5a4a,#0d4237);border-color:#177c66}
  .btn.warn{background:linear-gradient(135deg,#6b520e,#493c11);border-color:#7c6516}
  .btn.danger{background:linear-gradient(135deg,#6d1f3b,#4b162a);border-color:#8a284a}
  .card{background:linear-gradient(180deg,#12183b99,#0b103099);
        border:1px solid var(--border);border-radius:16px;padding:16px;
        box-shadow:0 10px 26px rgba(4,7,18,.45);}
  .grid{border:1px solid var(--grid);border-radius:12px;overflow:hidden;margin-top:12px}
  table{width:100%;border-collapse:separate;border-spacing:0}
  thead th{background:linear-gradient(180deg,#182155,#111741);
           padding:10px;text-align:left;font-family:Orbitron;font-size:.85rem;color:#dce7ff}
  td{padding:8px;border-bottom:1px solid var(--grid)}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .cell{width:100%;background:#0a0f29;color:var(--text);border:1px solid #223077;
        border-radius:8px;padding:8px;font-family:ui-monospace,Menlo,Consolas,monospace}
  .cell:focus{outline:2px solid var(--neon)}
  .hint{color:var(--muted);font-size:.9rem}
  .ok{color:var(--ok)} .bad{color:var(--bad)} .warn{color:var(--warn)}
  footer{color:var(--muted);text-align:center;padding:30px 0}
  .space{height:2px;margin:18px 0;background:linear-gradient(90deg,transparent,#47b6ff,#ff5bd1,transparent);opacity:.6;animation:move 8s linear infinite}
  @keyframes move{to{background-position:1200px 0}}
</style>
</head>
<body>
<header>
  <h1>Rants' Metadata Editor</h1>
  <div class="subtitle">IL2CPP <span class="mono">global-metadata.dat</span> ‚Äî inspect header ‚Ä¢ edit strings in place ‚Ä¢ export safely</div>
</header>
<main>
  <div class="card">
    <div class="bar">
      <button id="openBtn" class="btn">üìÇ Open global-metadata.dat</button>
      <input id="fileInput" type="file" accept=".dat,.bin" hidden />
      <input id="search" class="text" placeholder="Search strings‚Ä¶" />
      <button id="exportBtn" class="btn primary">‚¨áÔ∏è Download patched .dat</button>
      <span id="count" class="hint">0 strings</span>
    </div>
    <div class="grid" style="max-height:55vh;overflow:auto">
      <table>
        <thead><tr><th>Offset</th><th>Bytes</th><th>Original</th><th>Edited</th><th>Actions</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
    <div class="hint" id="status">Drop a file or click ‚ÄúOpen‚Äù.</div>
  </div>
  <div class="space"></div>
  <footer>Made for <a href="https://rantsszi.github.io/rants-metadata-editor/" style="color:#47b6ff">rantsszi.github.io/rants-metadata-editor</a></footer>
</main>

<script>
(() => {
const $=id=>document.getElementById(id);
const fileInput=$('fileInput'),openBtn=$('openBtn'),tbody=$('tbody'),
      exportBtn=$('exportBtn'),status=$('status'),countEl=$('count'),search=$('search');
let u8,dv,workBuf,strings=[],currentList=[],rendered=0,chunkSize=200;

function setStatus(t,c=''){status.textContent=t;status.className='hint '+c;}
function readI32(o){return dv.getInt32(o,true);}
function hex(n){return '0x'+(n>>>0).toString(16).padStart(8,'0');}
function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));}
function escapeAttr(s){return String(s).replace(/"/g,'&quot;');}

function detectHeader(){
  const sanity=readI32(0),version=readI32(4);
  const map={sanity,version};
  let off=8;
  for(let i=0;i<60;i++){map['f'+i+'Offset']=readI32(off);map['f'+i+'Count']=readI32(off+4);off+=8;}
  const offsets=Object.values(map).filter(v=>v>0&&v<workBuf.byteLength).sort((a,b)=>a-b);
  const stringStart=map.f4Offset||map.f6Offset||map.f8Offset||0;
  let stringEnd=workBuf.byteLength;
  for(const o of offsets){if(o>stringStart){stringEnd=o;break;}}
  return {map,stringStart,stringEnd};
}

function decodeCString(start,max){
  let end=start;while(end<max&&u8[end]!==0)end++;
  const bytes=u8.slice(start,end);
  const text=new TextDecoder().decode(bytes);
  return {text,bytesLength:bytes.length,endPlus1:Math.min(end+1,max)};
}
function scanStrings(start,end){
  const out=[];let p=start;const lim=Math.min(end,u8.length);
  while(p<lim){if(u8[p]===0){p++;continue;}
    const {text,bytesLength,endPlus1}=decodeCString(p,lim);
    if(bytesLength>0)out.push({offset:p,bytes:bytesLength+1,text,edited:text});
    p=endPlus1;}
  return out;
}
function trimToUtf8Bytes(str,max){
  const e=new TextEncoder();let l=0,h=str.length;
  while(l<h){const m=Math.ceil((l+h)/2);
    if(e.encode(str.slice(0,m)).length<=max)l=m;else h=m-1;}
  return str.slice(0,l);
}
function applyEdit(r,newText){
  const enc=new TextEncoder();const b=enc.encode(newText);
  if(b.length>r.bytes-1)return;
  u8.fill(0,r.offset,r.offset+r.bytes);u8.set(b,r.offset);
  r.edited=newText;setStatus(`Edited ${hex(r.offset)} (${b.length}/${r.bytes-1})`,'ok');
}
function zeroOut(r){u8.fill(0,r.offset,r.offset+r.bytes);r.edited='';setStatus(`Zeroed ${hex(r.offset)}`,'warn');}

function renderRows(list){tbody.innerHTML='';rendered=0;currentList=list;renderNextChunk();}
function renderNextChunk(){
  const frag=document.createDocumentFragment();
  const slice=currentList.slice(rendered,rendered+chunkSize);
  for(const r of slice){
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="mono">${hex(r.offset)}</td>
      <td class="mono">${r.bytes}</td>
      <td class="mono">${escapeHtml(r.text)}</td>
      <td><input class="cell mono edit" maxlength="${r.bytes-1}" value="${escapeAttr(r.edited)}"></td>
      <td><button class="btn mini" data-act="apply">Apply</button>
          <button class="btn mini" data-act="revert">Revert</button>
          <button class="btn mini danger" data-act="zero">Zero</button></td>`;
    const input=tr.querySelector('.edit');
    input.addEventListener('input',()=>{if(new TextEncoder().encode(input.value).length>r.bytes-1)
      input.value=trimToUtf8Bytes(input.value,r.bytes-1);});
    tr.querySelector('[data-act="apply"]').onclick=()=>applyEdit(r,input.value);
    tr.querySelector('[data-act="revert"]').onclick=()=>{input.value=r.text;applyEdit(r,r.text);};
    tr.querySelector('[data-act="zero"]').onclick=()=>zeroOut(r);
    frag.appendChild(tr);
  }
  tbody.appendChild(frag);
  rendered+=slice.length;
  if(rendered<currentList.length){
    const more=document.createElement('tr');
    more.innerHTML=`<td colspan="5" style="text-align:center">
      <button id="loadMoreBtn" class="btn">Load more (${currentList.length-rendered})</button></td>`;
    tbody.appendChild(more);
    more.querySelector('#loadMoreBtn').onclick=()=>{more.remove();requestAnimationFrame(renderNextChunk);};
  }
}
function applyFilter(){
  const val=search.value.trim();
  if(!val){renderRows(strings);countEl.textContent=strings.length+' strings';return;}
  let rx;try{rx=new RegExp(val,'i');}catch{setStatus('Invalid regex','bad');return;}
  const filtered=strings.filter(r=>rx.test(r.text)||rx.test(r.edited));
  renderRows(filtered);countEl.textContent=filtered.length+' strings';
}
function exportPatched(){
  const blob=new Blob([workBuf],{type:'application/octet-stream'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);a.download='global-metadata.patched.dat';a.click();
  setStatus('Patched file downloaded.','ok');
}

async function loadFile(f){
  const buf=await f.arrayBuffer();workBuf=buf.slice(0);
  u8=new Uint8Array(workBuf);dv=new DataView(workBuf);
  const {stringStart,stringEnd}=detectHeader();
  strings=scanStrings(stringStart,stringEnd);
  renderRows(strings);countEl.textContent=strings.length+' strings';
  setStatus(`Loaded ${f.name} (${strings.length} strings)`,'ok');
}

openBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{const f=e.target.files?.[0];if(f)loadFile(f);};
window.addEventListener('dragover',e=>e.preventDefault());
window.addEventListener('drop',e=>{e.preventDefault();const f=e.dataTransfer.files?.[0];if(f)loadFile(f);});
search.addEventListener('input',applyFilter);
exportBtn.onclick=exportPatched;
})();
</script>
</body>
</html>
